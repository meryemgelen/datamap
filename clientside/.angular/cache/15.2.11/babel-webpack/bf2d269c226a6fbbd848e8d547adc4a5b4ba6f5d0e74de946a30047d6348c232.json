{"ast":null,"code":"import * as L from 'leaflet';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../location.service\";\nimport * as i2 from \"@angular/common/http\";\nexport class MapComponent {\n  constructor(locationService, http) {\n    this.locationService = locationService;\n    this.http = http;\n    this.note = '';\n    this.selectedCoords = null;\n    this.markersLayer = L.layerGroup();\n    this.locations = []; // Verileri tutmak için bir array\n  }\n\n  ngOnInit() {\n    this.loadLocations(); // Map component'inin başında location'ları yükle\n    try {\n      this.initMap();\n      this.loadMarkers(); // Sayfa yüklendiğinde marker'ları yükle\n    } catch (error) {\n      console.error('Harita yüklenemedi:', error);\n    }\n  }\n  initMap() {\n    this.map = L.map('map').setView([39.92077, 32.85411], 6);\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n      maxZoom: 19\n    }).addTo(this.map);\n    this.markersLayer.addTo(this.map); // Marker katmanını haritaya ekle\n    // Haritaya tıklama olayını ekle\n    this.map.on('click', e => {\n      const {\n        lat,\n        lng\n      } = e.latlng;\n      this.selectedCoords = e.latlng;\n      const popupContent = `\n        <div>\n          <strong>Koordinatlar:</strong>\n          <p>Lat: ${lat.toFixed(5)}, Lng: ${lng.toFixed(5)}</p>\n          <textarea id=\"noteInput\" placeholder=\"Not ekleyin...\"></textarea><br>\n          <button id=\"saveNote\">Kaydet</button>\n          <button id=\"deleteNote\">Sil</button>\n        </div>\n      `;\n      const popup = L.popup().setLatLng(e.latlng).setContent(popupContent).openOn(this.map);\n      // Popup butonlarına tıklama olaylarını bağla\n      setTimeout(() => {\n        document.getElementById('saveNote')?.addEventListener('click', () => this.saveNote());\n        document.getElementById('deleteNote')?.addEventListener('click', () => this.deleteNote());\n      });\n    });\n  }\n  saveNote() {\n    const noteInput = document.getElementById('noteInput')?.value;\n    if (this.selectedCoords && noteInput) {\n      const data = {\n        lat: this.selectedCoords.lat,\n        lng: this.selectedCoords.lng,\n        note: noteInput\n      };\n      this.http.post('/api/locations', data).subscribe({\n        next: () => alert('Not kaydedildi!'),\n        error: err => console.error('Not kaydedilemedi:', err)\n      });\n    } else {\n      alert('Lütfen bir not girin!');\n    }\n  }\n  deleteNote() {\n    if (this.selectedCoords) {\n      this.http.delete(`/api/locations?lat=${this.selectedCoords.lat}&lng=${this.selectedCoords.lng}`).subscribe({\n        next: () => alert('Not silindi!'),\n        error: err => console.error('Not silinemedi:', err)\n      });\n    }\n  }\n  loadLocations() {\n    this.http.get('http://localhost:3000/locations').subscribe(locations => {\n      console.log('Alınan Locations Verisi:', locations); // API'den gelen veriyi kontrol et\n      this.locations = locations; // Veriyi locations array'ine kaydet\n      this.addMarkers(); // Marker'ları eklemek için fonksiyonu çağır\n    }, error => {\n      console.error('Veri Çekme Hatası:', error);\n    });\n  }\n  addMarkers() {\n    // Burada harita tekrar oluşturulmasına gerek yok\n    this.markersLayer.clearLayers(); // Eski marker'ları temizle\n    this.locations.forEach(location => {\n      const {\n        latitude,\n        longitude,\n        note\n      } = location; // Konum ve notları çıkar\n      if (latitude && longitude) {\n        L.marker([latitude, longitude]).addTo(this.markersLayer).bindPopup(`<b>Not:</b> ${note}`).openPopup(); // Marker'a popup ekleyin\n      }\n    });\n  }\n\n  loadMarkers() {\n    this.http.get('http://localhost:3000/locations').subscribe(locations => {\n      console.log(locations);\n      this.markersLayer.clearLayers(); // Eski marker'ları temizle\n      locations.forEach(location => {\n        // Veritabanından gelen her konum için bir marker ekle\n        const marker = L.marker([location.latitude, location.longitude]).bindPopup(`<b>Not:</b> ${location.note}`).addTo(this.markersLayer); // Katmana ekle\n      });\n    }, error => {\n      console.error('Veritabanı verileri alınamadı:', error);\n    });\n  }\n  addMarker(latitude, longitude, note) {\n    this.http.post('http://localhost:3000/locations', {\n      latitude,\n      longitude,\n      note\n    }).subscribe(() => {\n      this.loadMarkers(); // Marker eklendikten sonra yeniden yükle\n    });\n  }\n\n  deleteMarker(latitude, longitude) {\n    this.http.delete(`http://localhost:3000/locations?lat=${latitude}&lng=${longitude}`).subscribe(() => {\n      this.loadMarkers(); // Marker silindikten sonra yeniden yükle\n    });\n  }\n\n  static {\n    this.ɵfac = function MapComponent_Factory(t) {\n      return new (t || MapComponent)(i0.ɵɵdirectiveInject(i1.LocationService), i0.ɵɵdirectiveInject(i2.HttpClient));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: MapComponent,\n      selectors: [[\"app-map\"]],\n      decls: 1,\n      vars: 0,\n      consts: [[\"id\", \"map\", 2, \"height\", \"600px\"]],\n      template: function MapComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelement(0, \"div\", 0);\n        }\n      },\n      styles: [\"#map[_ngcontent-%COMP%] {\\n  height: 100%;\\n  width: 100%;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvbWFwL21hcC5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLFlBQUE7RUFDQSxXQUFBO0FBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIjbWFwIHtcclxuICBoZWlnaHQ6IDEwMCU7XHJcbiAgd2lkdGg6IDEwMCU7XHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["L","MapComponent","constructor","locationService","http","layerGroup","ngOnInit","loadLocations","initMap","loadMarkers","error","console","map","setView","tileLayer","maxZoom","addTo","markersLayer","on","e","lat","lng","latlng","selectedCoords","popupContent","toFixed","popup","setLatLng","setContent","openOn","setTimeout","document","getElementById","addEventListener","saveNote","deleteNote","noteInput","value","data","note","post","subscribe","next","alert","err","delete","get","locations","log","addMarkers","clearLayers","forEach","location","latitude","longitude","marker","bindPopup","openPopup","addMarker","deleteMarker","selectors","decls","vars","consts","template","i0"],"sourceRoot":"","sources":["C:\\Users\\meryem\\Desktop\\duyg\\my-angular-map\\src\\app\\map\\map.component.ts","C:\\Users\\meryem\\Desktop\\duyg\\my-angular-map\\src\\app\\map\\map.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport * as L from 'leaflet';\nimport { LocationService } from '../location.service';\nimport { HttpClient } from '@angular/common/http';\nimport { environment } from 'src/environments/environment';\n\n@Component({\n  selector: 'app-map',\n  templateUrl: './map.component.html',\n  styleUrls: ['./map.component.scss'],\n})\nexport class MapComponent implements OnInit {\n  map!: L.Map;\n  note: string = '';\n  selectedCoords: L.LatLng | null = null;\n  private markersLayer: L.LayerGroup = L.layerGroup();\n\n  locations: any[] = [];  // Verileri tutmak için bir array\n\n  constructor(private locationService: LocationService, private http: HttpClient) {}\n\n  ngOnInit(): void {\n    this.loadLocations();  // Map component'inin başında location'ları yükle\n    try {\n      this.initMap();\n      this.loadMarkers();  // Sayfa yüklendiğinde marker'ları yükle\n    } catch (error) {\n      console.error('Harita yüklenemedi:', error);\n    }\n  }\n\n  initMap(): void {\n    this.map = L.map('map').setView([39.92077, 32.85411], 6);\n\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n      maxZoom: 19,\n    }).addTo(this.map);\n\n    this.markersLayer.addTo(this.map);  // Marker katmanını haritaya ekle\n\n    // Haritaya tıklama olayını ekle\n    this.map.on('click', (e: L.LeafletMouseEvent) => {\n      const { lat, lng } = e.latlng;\n      this.selectedCoords = e.latlng;\n      const popupContent = `\n        <div>\n          <strong>Koordinatlar:</strong>\n          <p>Lat: ${lat.toFixed(5)}, Lng: ${lng.toFixed(5)}</p>\n          <textarea id=\"noteInput\" placeholder=\"Not ekleyin...\"></textarea><br>\n          <button id=\"saveNote\">Kaydet</button>\n          <button id=\"deleteNote\">Sil</button>\n        </div>\n      `;\n      const popup = L.popup()\n        .setLatLng(e.latlng)\n        .setContent(popupContent)\n        .openOn(this.map);\n\n      // Popup butonlarına tıklama olaylarını bağla\n      setTimeout(() => {\n        document.getElementById('saveNote')?.addEventListener('click', () => this.saveNote());\n        document.getElementById('deleteNote')?.addEventListener('click', () => this.deleteNote());\n      });\n    });\n  }\n\n  saveNote(): void {\n    const noteInput = (document.getElementById('noteInput') as HTMLTextAreaElement)?.value;\n    if (this.selectedCoords && noteInput) {\n      const data = {\n        lat: this.selectedCoords.lat,\n        lng: this.selectedCoords.lng,\n        note: noteInput,\n      };\n      this.http.post('/api/locations', data).subscribe({\n        next: () => alert('Not kaydedildi!'),\n        error: (err) => console.error('Not kaydedilemedi:', err),\n      });\n    } else {\n      alert('Lütfen bir not girin!');\n    }\n  }\n\n  deleteNote(): void {\n    if (this.selectedCoords) {\n      this.http.delete(`/api/locations?lat=${this.selectedCoords.lat}&lng=${this.selectedCoords.lng}`).subscribe({\n        next: () => alert('Not silindi!'),\n        error: (err) => console.error('Not silinemedi:', err),\n      });\n    }\n  }\n\n  loadLocations(): void {\n    this.http.get<any[]>('http://localhost:3000/locations').subscribe(\n      locations => {\n        console.log('Alınan Locations Verisi:', locations); // API'den gelen veriyi kontrol et\n        this.locations = locations;  // Veriyi locations array'ine kaydet\n        this.addMarkers();  // Marker'ları eklemek için fonksiyonu çağır\n      },\n      error => {\n        console.error('Veri Çekme Hatası:', error);\n      }\n    );\n  }\n\n  addMarkers(): void {\n    // Burada harita tekrar oluşturulmasına gerek yok\n    this.markersLayer.clearLayers();  // Eski marker'ları temizle\n\n    this.locations.forEach(location => {\n      const { latitude, longitude, note } = location;  // Konum ve notları çıkar\n      if (latitude && longitude) {\n        L.marker([latitude, longitude]).addTo(this.markersLayer)\n          .bindPopup(`<b>Not:</b> ${note}`)\n          .openPopup();  // Marker'a popup ekleyin\n      }\n    });\n  }\n\n  loadMarkers(): void {\n    this.http.get<any[]>('http://localhost:3000/locations').subscribe(locations => {\n      console.log(locations);\n      this.markersLayer.clearLayers();  // Eski marker'ları temizle\n\n      locations.forEach(location => {\n        // Veritabanından gelen her konum için bir marker ekle\n        const marker = L.marker([location.latitude, location.longitude])\n          .bindPopup(`<b>Not:</b> ${location.note}`)\n          .addTo(this.markersLayer);  // Katmana ekle\n      });\n    },\n    error => {\n      console.error('Veritabanı verileri alınamadı:', error);\n    });\n  }\n\n  addMarker(latitude: number, longitude: number, note: string): void {\n    this.http.post('http://localhost:3000/locations', { latitude, longitude, note }).subscribe(() => {\n      this.loadMarkers();  // Marker eklendikten sonra yeniden yükle\n    });\n  }\n\n  deleteMarker(latitude: number, longitude: number): void {\n    this.http.delete(`http://localhost:3000/locations?lat=${latitude}&lng=${longitude}`).subscribe(() => {\n      this.loadMarkers();  // Marker silindikten sonra yeniden yükle\n    });\n  }\n}\n","<div id=\"map\" style=\"height: 600px;\"></div>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}